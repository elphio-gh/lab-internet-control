from src.utils.logger import log
from src.utils.config import config

class I18n:
    """
    Gestisce l'internazionalizzazione dell'applicazione.
    """
    
    LANGUAGES = {
        "it": "üáÆüáπ Italiano",
        "en": "üá¨üáß English",
        "de": "üá©üá™ Deutsch",
        "fr": "üá´üá∑ Fran√ßais",
        "es": "üá™üá∏ Espa√±ol"
    }

    TRANSLATIONS = {
        "it": {
            "APP_TITLE": "Lab Internet Control - Dashboard Docente",
            "BLOCK": "BLOCCA INTERNET",
            "UNBLOCK": "SBLOCCA INTERNET",
            "WL_ON": "CONSENTI WHITELIST",
            "WL_OFF": "DISATTIVA WHITELIST",
            "SETTINGS": "Impostazioni",
            "LAB_STATUS": "Stato Laboratorio",
            "MSG_BLOCK": "Comando BLOCCO inviato a {} PC.",
            "MSG_UNBLOCK": "Comando SBLOCCO inviato a {} PC.",
            "MSG_WHITELIST": "Comando WHITELIST inviato a {} PC.",
            "TAB_GENERAL": "Generali",
            "TAB_WHITELIST": "Whitelist",
            "LBL_LANG": "Lingua (Riavvio richiesto)",
            "LBL_MODE": "Modalit√† di Blocco",
            "MODE_RESTART": "Fino al riavvio (Consigliato)",
            "MODE_MANUAL": "Manuale (Sblocco Manuale)",
            "BTN_EDIT_WL": "‚úèÔ∏è Modifica",
            "BTN_ADD": "Aggiungi",
            "BTN_REMOVE": "Rimuovi Selezionato",
            "BTN_SAVE": "Salva",
            "ERR_NO_SEL": "Nessun elemento selezionato.",
            "SAVED": "Impostazioni salvate.",
            "BTN_DOWNLOAD_TEMPLATE": "üì• Scarica Esempio CSV",
            "MSG_TEMPLATE_SAVED": "File di esempio salvato correttamente.",
            "UNSAVED_CHANGES_TITLE": "Modifiche non salvate",
            "UNSAVED_CHANGES_MSG": "Ci sono modifiche non salvate alla Whitelist.\nVuoi salvarle prima di attivare la Whitelist?",
            "TAB_ABOUT": "‚ÑπÔ∏è Info",
            "LBL_VERSION": "Versione",
            "LBL_AUTHOR": "Autore",
            "LBL_LICENSE": "Licenza",
            "LEGAL_NOTES": "Questo software √® fornito 'cos√¨ com'√®', senza garanzie di alcun tipo.\nL'autore non √® responsabile per eventuali danni causati dall'uso improprio.",
            "MSG_BLOCK_RESTART": "Internet BLOCCATO (Sblocco autom. al riavvio).",
            "MSG_BLOCK_MANUAL": "Internet BLOCCATO (Permanente).",
            "EXIT_TITLE": "Blocco Attivo",
            "EXIT_MSG_MANUAL": "‚ö†Ô∏è Il blocco internet √® attivo e PERMANENTE (Manuale).\nSe esci ora, i PC rimarranno bloccati finch√© non li sblocchi manualmente.\n\nVuoi SBLOCCARE tutto prima di uscire?",
            "EXIT_MSG_RESTART": "‚ÑπÔ∏è Il blocco internet √® attivo (RunOnce).\nI PC si sbloccheranno automaticamente al prossimo riavvio.\n\nVuoi comunque sbloccare tutto ora?",
            "EXIT_MSG_WL": "‚ö†Ô∏è La Whitelist √® attiva.\nSe esci ora, i PC avranno accesso limitato.\n\nVuoi SBLOCCARE tutto (ripristino accesso completo) prima di uscire?",
            "STATUS_ON": "‚úÖ INTERNET ON",
            "STATUS_WL": "üõ°Ô∏è WHITELIST",
            "STATUS_OFF": "‚õî BLOCCATO",
            "STATUS_DETAIL_RESTART": "Fino al prossimo riavvio",
            "STATUS_DETAIL_MANUAL": "Permanente\n(Sblocco manuale richiesto)",
        },
        "en": {
            "APP_TITLE": "Lab Internet Control - Teacher Dashboard",
            "BLOCK": "BLOCK INTERNET",
            "UNBLOCK": "UNBLOCK INTERNET",
            "WL_ON": "ALLOW WHITELIST",
            "WL_OFF": "DISABLE WHITELIST",
            "SETTINGS": "Settings",
            "LAB_STATUS": "Lab Status",
            "MSG_BLOCK": "BLOCK command sent to {} PCs.",
            "MSG_UNBLOCK": "UNBLOCK command sent to {} PCs.",
            "MSG_WHITELIST": "WHITELIST command sent to {} PCs.",
            "TAB_GENERAL": "General",
            "TAB_WHITELIST": "Whitelist",
            "LBL_LANG": "Language (Restart required)",
            "LBL_MODE": "Blocking Mode",
            "MODE_RESTART": "Until Restart (Recommended)",
            "MODE_MANUAL": "Manual (Manual Unblock)",
            "BTN_EDIT_WL": "‚úèÔ∏è Edit",
            "BTN_ADD": "Add",
            "BTN_REMOVE": "Remove Selected",
            "BTN_SAVE": "Save",
            "ERR_NO_SEL": "No item selected.",
            "SAVED": "Settings saved.",
            "BTN_DOWNLOAD_TEMPLATE": "üì• Download CSV Example",
            "MSG_TEMPLATE_SAVED": "Example file saved successfully.",
            "UNSAVED_CHANGES_TITLE": "Unsaved Changes",
            "UNSAVED_CHANGES_MSG": "There are unsaved changes to the Whitelist.\nDo you want to save them before enabling the Whitelist?",
            "TAB_ABOUT": "‚ÑπÔ∏è About",
            "LBL_VERSION": "Version",
            "LBL_AUTHOR": "Author",
            "LBL_LICENSE": "License",
            "LEGAL_NOTES": "This software is provided 'as is', without warranty of any kind.\nThe author is not liable for any damages arising from valid or invalid use.",
            "MSG_BLOCK_RESTART": "Internet BLOCKED (Auto-unblock on restart).",
            "MSG_BLOCK_MANUAL": "Internet BLOCKED (Permanent).",
            "EXIT_TITLE": "Block Active",
            "EXIT_MSG_MANUAL": "‚ö†Ô∏è Internet block is active and PERMANENT (Manual).\nIf you exit, PCs will remain blocked.\n\nDo you want to UNBLOCK everything before exiting?",
            "EXIT_MSG_RESTART": "‚ÑπÔ∏è Internet block is active (RunOnce).\nPCs will unblock automatically on restart.\n\nDo you want to unblock everything now?",
            "EXIT_MSG_WL": "‚ö†Ô∏è Whitelist is active.\nIf you exit, PCs will have limited access.\n\nDo you want to UNBLOCK everything (full access) before exiting?",
            "STATUS_ON": "‚úÖ INTERNET ON",
            "STATUS_WL": "üõ°Ô∏è WHITELIST",
            "STATUS_OFF": "‚õî BLOCKED",
            "STATUS_DETAIL_RESTART": "Until next restart",
            "STATUS_DETAIL_MANUAL": "Permanent\n(Manual unblock required)",
        },
        "de": {
            "APP_TITLE": "Lab Internet Control - Lehrer Dashboard",
            "BLOCK": "INTERNET SPERREN",
            "UNBLOCK": "INTERNET FREIGEBEN",
            "WL_ON": "WHITELIST ERLAUBEN",
            "WL_OFF": "WHITELIST DEAKTIVIEREN",
            "SETTINGS": "Einstellungen",
            "LAB_STATUS": "Laborstatus",
            "MSG_BLOCK": "SPERREN Befehl gesendet an {} PCs.",
            "MSG_UNBLOCK": "FREIGEBEN Befehl gesendet an {} PCs.",
            "MSG_WHITELIST": "WHITELIST Befehl gesendet an {} PCs.",
            "TAB_GENERAL": "Allgemein",
            "TAB_WHITELIST": "Whitelist",
            "LBL_LANG": "Sprache (Neustart erforderlich)",
            "LBL_MODE": "Sperrmodus",
            "MODE_RESTART": "Bis Neustart (Empfohlen)",
            "MODE_MANUAL": "Manuell (Manuelle Freigabe)",
            "BTN_EDIT_WL": "‚úèÔ∏è Bearbeiten",
            "BTN_ADD": "Hinzuf√ºgen",
            "BTN_REMOVE": "Ausgew√§hlte entfernen",
            "BTN_SAVE": "Speichern",
            "ERR_NO_SEL": "Kein Element ausgew√§hlt.",
            "SAVED": "Einstellungen gespeichert.",
            "BTN_DOWNLOAD_TEMPLATE": "üì• CSV-Beispiel herunterladen",
            "MSG_TEMPLATE_SAVED": "Beispieldatei erfolgreich gespeichert.",
            "UNSAVED_CHANGES_TITLE": "Ungespeicherte √Ñnderungen",
            "UNSAVED_CHANGES_MSG": "Es gibt ungespeicherte √Ñnderungen an der Whitelist.\nM√∂chten Sie diese speicher, bevor Sie die Whitelist aktivieren?",
            "TAB_ABOUT": "‚ÑπÔ∏è Info",
            "LBL_VERSION": "Version",
            "LBL_AUTHOR": "Autor",
            "LBL_LICENSE": "Lizenz",
            "LEGAL_NOTES": "Diese Software wird ohne M√§ngelgew√§hr bereitgestellt.\nDer Autor haftet nicht f√ºr Sch√§den, die durch unsachgem√§√üe Verwendung entstehen.",
            "MSG_BLOCK_RESTART": "Internet GESPERRT (Auto-Freigabe bei Neustart).",
            "MSG_BLOCK_MANUAL": "Internet GESPERRT (Permanent).",
            "EXIT_TITLE": "Sperre Aktiv",
            "EXIT_MSG_MANUAL": "‚ö†Ô∏è Internetsperre ist aktiv und PERMANENT (Manuell).\nWenn Sie beenden, bleiben die PCs gesperrt.\n\nM√∂chten Sie vor dem Beenden alles ENTSPERREN?",
            "EXIT_MSG_RESTART": "‚ÑπÔ∏è Internetsperre ist aktiv (RunOnce).\nPCs werden beim Neustart automatisch entsperrt.\n\nM√∂chten Sie trotzdem jetzt alles entsperren?",
            "EXIT_MSG_WL": "‚ö†Ô∏è Whitelist ist aktiv.\nWenn Sie beenden, haben PCs eingeschr√§nkten Zugriff.\n\nM√∂chten Sie vor dem Beenden alles ENTSPERREN?",
            "STATUS_ON": "‚úÖ INTERNET ON",
            "STATUS_WL": "üõ°Ô∏è WHITELIST",
            "STATUS_OFF": "‚õî GESPERRT",
            "STATUS_DETAIL_RESTART": "Bis zum n√§chsten Neustart",
            "STATUS_DETAIL_MANUAL": "Permanent\n(Manuelle Freigabe erforderlich)",
        },
        "fr": {
            "APP_TITLE": "Lab Internet Control - Tableau de Bord Enseignant",
            "BLOCK": "BLOQUER INTERNET",
            "UNBLOCK": "D√âBLOQUER INTERNET",
            "WL_ON": "AUTORISER WHITELIST",
            "WL_OFF": "D√âSACTIVER WHITELIST",
            "SETTINGS": "Param√®tres",
            "LAB_STATUS": "√âtat du Laboratoire",
            "MSG_BLOCK": "Commande BLOQUER envoy√©e √† {} PC.",
            "MSG_UNBLOCK": "Commande D√âBLOQUER envoy√©e √† {} PC.",
            "MSG_WHITELIST": "Commande WHITELIST envoy√©e √† {} PC.",
            "TAB_GENERAL": "G√©n√©ral",
            "TAB_WHITELIST": "Liste Blanche",
            "LBL_LANG": "Langue (Red√©marrage requis)",
            "LBL_MODE": "Mode de Blocage",
            "MODE_RESTART": "Jusqu'au red√©marrage (Recommand√©)",
            "MODE_MANUAL": "Manuel (D√©blocage Manuel)",
            "BTN_EDIT_WL": "‚úèÔ∏è Modifier",
            "BTN_ADD": "Ajouter",
            "BTN_REMOVE": "Supprimer la s√©lection",
            "BTN_SAVE": "Enregistrer",
            "ERR_NO_SEL": "Aucun √©l√©ment s√©lectionn√©.",
            "SAVED": "Param√®tres enregistr√©s.",
            "BTN_DOWNLOAD_TEMPLATE": "üì• T√©l√©charger l'exemple CSV",
            "MSG_TEMPLATE_SAVED": "Fichier d'exemple enregistr√© avec succ√®s.",
            "UNSAVED_CHANGES_TITLE": "Modifications non enregistr√©es",
            "UNSAVED_CHANGES_MSG": "Il y a des modifications non enregistr√©es dans la liste blanche.\nVoulez-vous les enregistrer avant d'activer la liste blanche ?",
            "TAB_ABOUT": "‚ÑπÔ∏è √Ä propos",
            "LBL_VERSION": "Version",
            "LBL_AUTHOR": "Auteur",
            "LBL_LICENSE": "Licence",
            "LEGAL_NOTES": "Ce logiciel est fourni 'tel quel', sans aucune garantie.\nL'auteur n'est pas responsable des dommages caus√©s par une mauvaise utilisation.",
            "MSG_BLOCK_RESTART": "Internet BLOQU√â (D√©blocage auto au red√©marrage).",
            "MSG_BLOCK_MANUAL": "Internet BLOQU√â (Permanent).",
            "EXIT_TITLE": "Blocage Actif",
            "EXIT_MSG_MANUAL": "‚ö†Ô∏è Le blocage internet est actif et PERMANENT (Manuel).\nSi vous quittez, les PC resteront bloqu√©s.\n\nVoulez-vous TOUT D√âBLOQUER avant de quitter ?",
            "EXIT_MSG_RESTART": "‚ÑπÔ∏è Le blocage internet est actif (RunOnce).\nLes PC se d√©bloqueront automatiquement au red√©marrage.\n\nVoulez-vous quand m√™me tout d√©bloquer maintenant ?",
            "EXIT_MSG_WL": "‚ö†Ô∏è La liste blanche est active.\nSi vous quittez, les PC auront un acc√®s limit√©.\n\nVoulez-vous TOUT D√âBLOQUER (acc√®s complet) avant de quitter ?",
            "STATUS_ON": "‚úÖ INTERNET ON",
            "STATUS_WL": "üõ°Ô∏è WHITELIST",
            "STATUS_OFF": "‚õî BLOQU√â",
            "STATUS_DETAIL_RESTART": "Jusqu'au prochain red√©marrage",
            "STATUS_DETAIL_MANUAL": "Permanent\n(D√©blocage manuel requis)",
        },
        "es": {
            "APP_TITLE": "Lab Internet Control - Panel del Docente",
            "BLOCK": "BLOQUEAR INTERNET",
            "UNBLOCK": "DESBLOQUEAR INTERNET",
            "WL_ON": "PERMITIR WHITELIST",
            "WL_OFF": "DESACTIVAR WHITELIST",
            "SETTINGS": "Ajustes",
            "LAB_STATUS": "Estado del Laboratorio",
            "MSG_BLOCK": "Comando BLOQUEO enviado a {} PC.",
            "MSG_UNBLOCK": "Comando DESBLOQUEO enviado a {} PC.",
            "MSG_WHITELIST": "Comando WHITELIST enviado a {} PC.",
            "TAB_GENERAL": "General",
            "TAB_WHITELIST": "Lista Blanca",
            "LBL_LANG": "Idioma (Reinicio requerido)",
            "LBL_MODE": "Modo de Bloqueo",
            "MODE_RESTART": "Hasta reiniciar (Recomendado)",
            "MODE_MANUAL": "Manual (Desbloqueo Manual)",
            "BTN_EDIT_WL": "‚úèÔ∏è Editar",
            "BTN_ADD": "A√±adir",
            "BTN_REMOVE": "Eliminar selecci√≥n",
            "BTN_SAVE": "Guardar",
            "ERR_NO_SEL": "Ning√∫n elemento seleccionado.",
            "SAVED": "Ajustes guardados.",
            "BTN_DOWNLOAD_TEMPLATE": "üì• Descargar ejemplo CSV",
            "MSG_TEMPLATE_SAVED": "Archivo de ejemplo guardado correctamente.",
            "UNSAVED_CHANGES_TITLE": "Cambios no guardados",
            "UNSAVED_CHANGES_MSG": "Hay cambios no guardados en la lista blanca.\n¬øQuieres guardarlos antes de activar la lista blanca?",
            "TAB_ABOUT": "‚ÑπÔ∏è Acerca de",
            "LBL_VERSION": "Versi√≥n",
            "LBL_AUTHOR": "Autor",
            "LBL_LICENSE": "Licencia",
            "LEGAL_NOTES": "Este software se proporciona 'tal cual', sin garant√≠a de ning√∫n tipo.\nEl autor no se hace responsable de los da√±os causados por el uso indebido.",
            "MSG_BLOCK_RESTART": "Internet BLOQUEADO (Desbloqueo auto al reiniciar).",
            "MSG_BLOCK_MANUAL": "Internet BLOQUEADO (Permanente).",
            "EXIT_TITLE": "Bloqueo Activo",
            "EXIT_MSG_MANUAL": "‚ö†Ô∏è El bloqueo de internet est√° activo y es PERMANENTE (Manual).\nSi sales, los PC permanecer√°n bloqueados.\n\n¬øQuieres DESBLOQUEAR todo antes de salir?",
            "EXIT_MSG_RESTART": "‚ÑπÔ∏è El bloqueo de internet est√° activo (RunOnce).\nLos PC se desbloquear√°n autom√°ticamente al reiniciar.\n\n¬øQuieres desbloquear todo ahora?",
            "EXIT_MSG_WL": "‚ö†Ô∏è La lista blanca est√° activa.\nSi sales, los PC tendr√°n acceso limitado.\n\n¬øQuieres DESBLOQUEAR todo (acceso completo) antes de salir?",
            "STATUS_ON": "‚úÖ INTERNET ON",
            "STATUS_WL": "üõ°Ô∏è WHITELIST",
            "STATUS_OFF": "‚õî BLOQUEADO",
            "STATUS_DETAIL_RESTART": "Hasta el pr√≥ximo reinicio",
            "STATUS_DETAIL_MANUAL": "Permanente\n(Requiere desbloqueo manual)",
        }
    }

    def __init__(self):
        self.current_lang = config.get("language") or "it"
        if self.current_lang not in self.TRANSLATIONS:
            log.warning(f"Lingua '{self.current_lang}' non supportata. Fallback su 'it'.")
            self.current_lang = "it"

    def t(self, key):
        """Restituisce la traduzione per la chiave data."""
        return self.TRANSLATIONS[self.current_lang].get(key, key)

# Istanza globale
i18n = I18n()
