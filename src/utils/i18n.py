from src.utils.logger import log
from src.utils.config import config

class I18n:
    """
    Gestisce l'internazionalizzazione dell'applicazione.
    """
    
    LANGUAGES = {
        "it": "Italiano",
        "en": "English",
        "de": "Deutsch",
        "fr": "Français",
        "es": "Español"
    }

    TRANSLATIONS = {
        "it": {
            "APP_TITLE": "Lab Internet Control - Dashboard Docente",
            "BLOCK": "BLOCCA INTERNET",
            "UNBLOCK": "SBLOCCA INTERNET",
            "WL_ON": "CONSENTI WHITELIST",
            "WL_OFF": "DISATTIVA WHITELIST",
            "SETTINGS": "Impostazioni",
            "LAB_STATUS": "Stato Laboratorio",
            "MSG_BLOCK": "Comando BLOCCO inviato a {} PC.",
            "MSG_UNBLOCK": "Comando SBLOCCO inviato a {} PC.",
            "MSG_WHITELIST": "Comando WHITELIST inviato a {} PC.",
            "TAB_GENERAL": "Generali",
            "TAB_WHITELIST": "Whitelist",
            "LBL_LANG": "Lingua (Riavvio richiesto)",
            "LBL_MODE": "Modalità di Blocco",
            "MODE_RESTART": "Fino al riavvio (Consigliato)",
            "MODE_MANUAL": "Manuale (Sblocco Manuale)",
            "BTN_EDIT_WL": "Modifica",
            "BTN_ADD": "Aggiungi",
            "BTN_REMOVE": "Rimuovi Selezionato",
            "BTN_SAVE": "Salva",
            "BTN_KEEP_BLOCK": "MANTIENI BLOCCO",
            "BTN_REMOVE_BLOCK": "RIMUOVI BLOCCO",
            "ERR_NO_SEL": "Nessun elemento selezionato.",
            "SAVED": "Impostazioni salvate.",
            "BTN_DOWNLOAD_TEMPLATE": "Scarica Esempio CSV",
            "MSG_TEMPLATE_SAVED": "File di esempio salvato correttamente.",
            "UNSAVED_CHANGES_TITLE": "Modifiche non salvate",
            "UNSAVED_CHANGES_MSG": "Ci sono modifiche non salvate alla Whitelist.\nVuoi salvarle prima di attivare la Whitelist?",
            "TAB_ABOUT": "Info",
            "LBL_VERSION": "Versione",
            "LBL_AUTHOR": "Autore",
            "LBL_LICENSE": "Licenza",
            "LEGAL_NOTES": "Questo software è fornito 'così com'è', senza garanzie di alcun tipo.\nL'autore non è responsabile per eventuali danni causati dall'uso improprio.",
            "MSG_BLOCK_RESTART": "Internet BLOCCATO (Sblocco autom. al riavvio).",
            "MSG_BLOCK_MANUAL": "Internet BLOCCATO (Permanente).",
            "EXIT_TITLE": "Blocco Attivo",
            "EXIT_MSG_MANUAL": "Il blocco internet è attivo e PERMANENTE (Manuale).\nSe esci ora, i PC rimarranno bloccati finché non li sblocchi manualmente.\n\nVuoi SBLOCCARE tutto prima di uscire?",
            "EXIT_MSG_RESTART": "Il blocco internet è attivo (RunOnce).\nI PC si sbloccheranno automaticamente al prossimo riavvio.\n\nVuoi comunque sbloccare tutto ora?",
            "EXIT_MSG_WL": "La Whitelist è attiva.\nSe esci ora, i PC avranno accesso limitato.\n\nVuoi SBLOCCARE tutto (ripristino accesso completo) prima di uscire?",
            "STATUS_ON": "INTERNET ON",
            "STATUS_WL": "WHITELIST",
            "STATUS_OFF": "BLOCCATO",
            "STATUS_DETAIL_RESTART": "Fino al prossimo riavvio",
            "STATUS_DETAIL_MANUAL": "Permanente\n(Sblocco manuale richiesto)",
        },
        "en": {
            "APP_TITLE": "Lab Internet Control - Teacher Dashboard",
            "BLOCK": "BLOCK INTERNET",
            "UNBLOCK": "UNBLOCK INTERNET",
            "WL_ON": "ALLOW WHITELIST",
            "WL_OFF": "DISABLE WHITELIST",
            "SETTINGS": "Settings",
            "LAB_STATUS": "Lab Status",
            "MSG_BLOCK": "BLOCK command sent to {} PCs.",
            "MSG_UNBLOCK": "UNBLOCK command sent to {} PCs.",
            "MSG_WHITELIST": "WHITELIST command sent to {} PCs.",
            "TAB_GENERAL": "General",
            "TAB_WHITELIST": "Whitelist",
            "LBL_LANG": "Language (Restart required)",
            "LBL_MODE": "Blocking Mode",
            "MODE_RESTART": "Until Restart (Recommended)",
            "MODE_MANUAL": "Manual (Manual Unblock)",
            "BTN_EDIT_WL": "Edit",
            "BTN_ADD": "Add",
            "BTN_REMOVE": "Remove Selected",
            "BTN_SAVE": "Save",
            "BTN_KEEP_BLOCK": "KEEP BLOCK",
            "BTN_REMOVE_BLOCK": "REMOVE BLOCK",
            "ERR_NO_SEL": "No item selected.",
            "SAVED": "Settings saved.",
            "BTN_DOWNLOAD_TEMPLATE": "Download CSV Example",
            "MSG_TEMPLATE_SAVED": "Example file saved successfully.",
            "UNSAVED_CHANGES_TITLE": "Unsaved Changes",
            "UNSAVED_CHANGES_MSG": "There are unsaved changes to the Whitelist.\nDo you want to save them before enabling the Whitelist?",
            "TAB_ABOUT": "About",
            "LBL_VERSION": "Version",
            "LBL_AUTHOR": "Author",
            "LBL_LICENSE": "License",
            "LEGAL_NOTES": "This software is provided 'as is', without warranty of any kind.\nThe author is not liable for any damages arising from valid or invalid use.",
            "MSG_BLOCK_RESTART": "Internet BLOCKED (Auto-unblock on restart).",
            "MSG_BLOCK_MANUAL": "Internet BLOCKED (Permanent).",
            "EXIT_TITLE": "Block Active",
            "EXIT_MSG_MANUAL": "Internet block is active and PERMANENT (Manual).\nIf you exit, PCs will remain blocked.\n\nDo you want to UNBLOCK everything before exiting?",
            "EXIT_MSG_RESTART": "Internet block is active (RunOnce).\nPCs will unblock automatically on restart.\n\nDo you want to unblock everything now?",
            "EXIT_MSG_WL": "Whitelist is active.\nIf you exit, PCs will have limited access.\n\nDo you want to UNBLOCK everything (full access) before exiting?",
            "STATUS_ON": "INTERNET ON",
            "STATUS_WL": "WHITELIST",
            "STATUS_OFF": "BLOCKED",
            "STATUS_DETAIL_RESTART": "Until next restart",
            "STATUS_DETAIL_MANUAL": "Permanent\n(Manual unblock required)",
        },
        "de": {
            "APP_TITLE": "Lab Internet Control - Lehrer Dashboard",
            "BLOCK": "INTERNET SPERREN",
            "UNBLOCK": "INTERNET FREIGEBEN",
            "WL_ON": "WHITELIST ERLAUBEN",
            "WL_OFF": "WHITELIST DEAKTIVIEREN",
            "SETTINGS": "Einstellungen",
            "LAB_STATUS": "Laborstatus",
            "MSG_BLOCK": "SPERREN Befehl gesendet an {} PCs.",
            "MSG_UNBLOCK": "FREIGEBEN Befehl gesendet an {} PCs.",
            "MSG_WHITELIST": "WHITELIST Befehl gesendet an {} PCs.",
            "TAB_GENERAL": "Allgemein",
            "TAB_WHITELIST": "Whitelist",
            "LBL_LANG": "Sprache (Neustart erforderlich)",
            "LBL_MODE": "Sperrmodus",
            "MODE_RESTART": "Bis Neustart (Empfohlen)",
            "MODE_MANUAL": "Manuell (Manuelle Freigabe)",
            "BTN_EDIT_WL": "Bearbeiten",
            "BTN_ADD": "Hinzufügen",
            "BTN_REMOVE": "Ausgewählte entfernen",
            "BTN_SAVE": "Speichern",
            "BTN_KEEP_BLOCK": "SPERRE BEHALTEN",
            "BTN_REMOVE_BLOCK": "SPERRE ENTFERNEN",
            "ERR_NO_SEL": "Kein Element ausgewählt.",
            "SAVED": "Einstellungen gespeichert.",
            "BTN_DOWNLOAD_TEMPLATE": "CSV-Beispiel herunterladen",
            "MSG_TEMPLATE_SAVED": "Beispieldatei erfolgreich gespeichert.",
            "UNSAVED_CHANGES_TITLE": "Ungespeicherte Änderungen",
            "UNSAVED_CHANGES_MSG": "Es gibt ungespeicherte Änderungen an der Whitelist.\nMöchten Sie diese speicher, bevor Sie die Whitelist aktivieren?",
            "TAB_ABOUT": "Info",
            "LBL_VERSION": "Version",
            "LBL_AUTHOR": "Autor",
            "LBL_LICENSE": "Lizenz",
            "LEGAL_NOTES": "Diese Software wird ohne Mängelgewähr bereitgestellt.\nDer Autor haftet nicht für Schäden, die durch unsachgemäße Verwendung entstehen.",
            "MSG_BLOCK_RESTART": "Internet GESPERRT (Auto-Freigabe bei Neustart).",
            "MSG_BLOCK_MANUAL": "Internet GESPERRT (Permanent).",
            "EXIT_TITLE": "Sperre Aktiv",
            "EXIT_MSG_MANUAL": "Internetsperre ist aktiv und PERMANENT (Manuell).\nWenn Sie beenden, bleiben die PCs gesperrt.\n\nMöchten Sie vor dem Beenden alles ENTSPERREN?",
            "EXIT_MSG_RESTART": "Internetsperre ist aktiv (RunOnce).\nPCs werden beim Neustart automatisch entsperrt.\n\nMöchten Sie trotzdem jetzt alles entsperren?",
            "EXIT_MSG_WL": "Whitelist ist aktiv.\nWenn Sie beenden, haben PCs eingeschränkten Zugriff.\n\nMöchten Sie vor dem Beenden alles ENTSPERREN?",
            "STATUS_ON": "INTERNET ON",
            "STATUS_WL": "WHITELIST",
            "STATUS_OFF": "GESPERRT",
            "STATUS_DETAIL_RESTART": "Bis zum nächsten Neustart",
            "STATUS_DETAIL_MANUAL": "Permanent\n(Manuelle Freigabe erforderlich)",
        },
        "fr": {
            "APP_TITLE": "Lab Internet Control - Tableau de Bord Enseignant",
            "BLOCK": "BLOQUER INTERNET",
            "UNBLOCK": "DÉBLOQUER INTERNET",
            "WL_ON": "AUTORISER WHITELIST",
            "WL_OFF": "DÉSACTIVER WHITELIST",
            "SETTINGS": "Paramètres",
            "LAB_STATUS": "État du Laboratoire",
            "MSG_BLOCK": "Commande BLOQUER envoyée à {} PC.",
            "MSG_UNBLOCK": "Commande DÉBLOQUER envoyée à {} PC.",
            "MSG_WHITELIST": "Commande WHITELIST envoyée à {} PC.",
            "TAB_GENERAL": "Général",
            "TAB_WHITELIST": "Liste Blanche",
            "LBL_LANG": "Langue (Redémarrage requis)",
            "LBL_MODE": "Mode de Blocage",
            "MODE_RESTART": "Jusqu'au redémarrage (Recommandé)",
            "MODE_MANUAL": "Manuel (Déblocage Manuel)",
            "BTN_EDIT_WL": "Modifier",
            "BTN_ADD": "Ajouter",
            "BTN_REMOVE": "Supprimer la sélection",
            "BTN_SAVE": "Enregistrer",
            "BTN_KEEP_BLOCK": "GARDER LE BLOCAGE",
            "BTN_REMOVE_BLOCK": "DÉBLOQUER",
            "ERR_NO_SEL": "Aucun élément sélectionné.",
            "SAVED": "Paramètres enregistrés.",
            "BTN_DOWNLOAD_TEMPLATE": "Télécharger l'exemple CSV",
            "MSG_TEMPLATE_SAVED": "Fichier d'exemple enregistré avec succès.",
            "UNSAVED_CHANGES_TITLE": "Modifications non enregistrées",
            "UNSAVED_CHANGES_MSG": "Il y a des modifications non enregistrées dans la liste blanche.\nVoulez-vous les enregistrer avant d'activer la liste blanche ?",
            "TAB_ABOUT": "À propos",
            "LBL_VERSION": "Version",
            "LBL_AUTHOR": "Auteur",
            "LBL_LICENSE": "Licence",
            "LEGAL_NOTES": "Ce logiciel est fourni 'tel quel', sans aucune garantie.\nL'auteur n'est pas responsable des dommages causés par une mauvaise utilisation.",
            "MSG_BLOCK_RESTART": "Internet BLOQUÉ (Déblocage auto au redémarrage).",
            "MSG_BLOCK_MANUAL": "Internet BLOQUÉ (Permanent).",
            "EXIT_TITLE": "Blocage Actif",
            "EXIT_MSG_MANUAL": "Le blocage internet est actif et PERMANENT (Manuel).\nSi vous quittez, les PC resteront bloqués.\n\nVoulez-vous TOUT DÉBLOQUER avant de quitter ?",
            "EXIT_MSG_RESTART": "Le blocage internet est actif (RunOnce).\nLes PC se débloqueront automatiquement au redémarrage.\n\nVoulez-vous quand même tout débloquer maintenant ?",
            "EXIT_MSG_WL": "La liste blanche est active.\nSi vous quittez, les PC auront un accès limité.\n\nVoulez-vous TOUT DÉBLOQUER (accès complet) avant de quitter ?",
            "STATUS_ON": "INTERNET ON",
            "STATUS_WL": "WHITELIST",
            "STATUS_OFF": "BLOQUÉ",
            "STATUS_DETAIL_RESTART": "Jusqu'au prochain redémarrage",
            "STATUS_DETAIL_MANUAL": "Permanent\n(Déblocage manuel requis)",
        },
        "es": {
            "APP_TITLE": "Lab Internet Control - Panel del Docente",
            "BLOCK": "BLOQUEAR INTERNET",
            "UNBLOCK": "DESBLOQUEAR INTERNET",
            "WL_ON": "PERMITIR WHITELIST",
            "WL_OFF": "DESACTIVAR WHITELIST",
            "SETTINGS": "Ajustes",
            "LAB_STATUS": "Estado del Laboratorio",
            "MSG_BLOCK": "Comando BLOQUEO enviado a {} PC.",
            "MSG_UNBLOCK": "Comando DESBLOQUEO enviado a {} PC.",
            "MSG_WHITELIST": "Comando WHITELIST enviado a {} PC.",
            "TAB_GENERAL": "General",
            "TAB_WHITELIST": "Lista Blanca",
            "LBL_LANG": "Idioma (Reinicio requerido)",
            "LBL_MODE": "Modo de Bloqueo",
            "MODE_RESTART": "Hasta reiniciar (Recomendado)",
            "MODE_MANUAL": "Manual (Desbloqueo Manual)",
            "BTN_EDIT_WL": "Editar",
            "BTN_ADD": "Añadir",
            "BTN_REMOVE": "Eliminar selección",
            "BTN_SAVE": "Guardar",
            "BTN_KEEP_BLOCK": "MANTENER BLOQUEO",
            "BTN_REMOVE_BLOCK": "QUITAR BLOQUEO",
            "ERR_NO_SEL": "Ningún elemento seleccionado.",
            "SAVED": "Ajustes guardados.",
            "BTN_DOWNLOAD_TEMPLATE": "Descargar ejemplo CSV",
            "MSG_TEMPLATE_SAVED": "Archivo de ejemplo guardado correctamente.",
            "UNSAVED_CHANGES_TITLE": "Cambios no guardados",
            "UNSAVED_CHANGES_MSG": "Hay cambios no guardados en la lista blanca.\n¿Quieres guardarlos antes de activar la lista blanca?",
            "TAB_ABOUT": "Acerca de",
            "LBL_VERSION": "Versión",
            "LBL_AUTHOR": "Autor",
            "LBL_LICENSE": "Licencia",
            "LEGAL_NOTES": "Este software se proporciona 'tal cual', sin garantía de ningún tipo.\nEl autor no se hace responsable de los daños causados por el uso indebido.",
            "MSG_BLOCK_RESTART": "Internet BLOQUEADO (Desbloqueo auto al reiniciar).",
            "MSG_BLOCK_MANUAL": "Internet BLOQUEADO (Permanente).",
            "EXIT_TITLE": "Bloqueo Activo",
            "EXIT_MSG_MANUAL": "El bloqueo de internet está activo y es PERMANENTE (Manual).\nSi sales, los PC permanecerán bloqueados.\n\n¿Quieres DESBLOQUEAR todo antes de salir?",
            "EXIT_MSG_RESTART": "El bloqueo de internet está activo (RunOnce).\nLos PC se desbloquearán automáticamente al reiniciar.\n\n¿Quieres desbloquear todo ahora?",
            "EXIT_MSG_WL": "La lista blanca está activa.\nSi sales, los PC tendrán acceso limitado.\n\n¿Quieres DESBLOQUEAR todo (acceso completo) antes de salir?",
            "STATUS_ON": "INTERNET ON",
            "STATUS_WL": "WHITELIST",
            "STATUS_OFF": "BLOQUEADO",
            "STATUS_DETAIL_RESTART": "Hasta el próximo reinicio",
            "STATUS_DETAIL_MANUAL": "Permanente\n(Requiere desbloqueo manual)",
        }
    }

    def __init__(self):
        self.current_lang = config.get("language") or "it"
        if self.current_lang not in self.TRANSLATIONS:
            log.warning(f"Lingua '{self.current_lang}' non supportata. Fallback su 'it'.")
            self.current_lang = "it"

    def t(self, key):
        """Restituisce la traduzione per la chiave data."""
        return self.TRANSLATIONS[self.current_lang].get(key, key)

# Istanza globale
i18n = I18n()
